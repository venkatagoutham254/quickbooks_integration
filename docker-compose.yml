version: "3.8"
services:
  quickbooks_pg:
    image: postgres:15
    container_name: quickbooks_pg
    restart: always
    environment:
      POSTGRES_DB: aforo_quickbooks
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      TZ: UTC
      PGTZ: UTC
    ports:
      - "5439:5432"
    networks:
      - quickbooks-network
    command: postgres -c timezone=UTC

  quickbooks_app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: quickbooks_app
    ports:
      - "8095:8095"
    environment:
      - SPRING_DATASOURCE_URL=${SPRING_DATASOURCE_URL:-jdbc:postgresql://quickbooks_pg:5432/aforo_quickbooks}
      - SPRING_DATASOURCE_USERNAME=${SPRING_DATASOURCE_USERNAME:-postgres}
      - SPRING_DATASOURCE_PASSWORD=${SPRING_DATASOURCE_PASSWORD:-postgres}
      - METERING_SERVICE_URL=${METERING_SERVICE_URL:-http://98.86.167.163:8092}
      - QUICKBOOKS_OAUTH_REDIRECT_URI=${QUICKBOOKS_OAUTH_REDIRECT_URI:-http://quickbooks.dev.aforo.space:8095/api/quickbooks/callback}
      - QUICKBOOKS_API_BASE_URL=${QUICKBOOKS_API_BASE_URL:-https://sandbox-quickbooks.api.intuit.com}
      - QUICKBOOKS_ENVIRONMENT=${QUICKBOOKS_ENVIRONMENT:-sandbox}
      - JWT_SECRET=${JWT_SECRET:-change-me-please-change-me-32-bytes-min}
      - ORGANIZATION_SERVICE_URL=${ORGANIZATION_SERVICE_URL:-http://44.201.19.187:8081}
      - RATE_PLAN_SERVICE_URL=${RATE_PLAN_SERVICE_URL:-http://3.208.93.68:8080}
    depends_on:
      - quickbooks_pg
    networks:
      - quickbooks-network

networks:
  quickbooks-network:
    driver: bridge
