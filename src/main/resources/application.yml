application:
  name: quickbooks-integration-service

server:
  port: 8095

spring:
  application:
    name: quickbooks-integration
  
  datasource:
    url: jdbc:postgresql://localhost:5439/aforo_quickbooks
    username: postgres
    password: postgres
  
  jpa:
    hibernate:
      ddl-auto: none
  
  jackson:
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: UTC
  
  liquibase:
    enabled: true
    change-log: classpath:db/changelog/changelog-master.yml

# QuickBooks OAuth Configuration
quickbooks:
  oauth:
    client-id: ABCnALhqOW94O1K82fqZR83HxbzsTUk0Uiqw5hl5U6ypWcsMOe
    client-secret: 5LC895awdf526VCPtUEbFOs26OiMiMAZ3gmYUkWk
    redirect-uri: ${QUICKBOOKS_OAUTH_REDIRECT_URI:http://quickbooks.aforo.space:8095/api/quickbooks/callback}
    scope: com.intuit.quickbooks.accounting
    authorization-url: https://appcenter.intuit.com/connect/oauth2
    token-url: https://oauth.platform.intuit.com/oauth2/v1/tokens/bearer
    revoke-url: https://developer.api.intuit.com/v2/oauth2/tokens/revoke
    user-info-url: https://accounts.platform.intuit.com/v1/openid_connect/userinfo
  
  api:
    base-url: ${QUICKBOOKS_API_BASE_URL:https://sandbox-quickbooks.api.intuit.com}
    version: v3
    environment: ${QUICKBOOKS_ENVIRONMENT:sandbox}  # sandbox or production
    minor-version: 65
  
  rate-limit:
    requests-per-minute: 500
    concurrent-requests: 100

aforo:
  jwt:
    issuer: aforo-quickbooks
    secret: ${JWT_SECRET:change-me-please-change-me-32-bytes-min}
    expiryMinutes: 120
  cors:
    allowed-origins: ${CORS_ALLOWED_ORIGINS:http://ui.dev.aforo.space,http://product.dev.aforo.space:8080,http://metering.dev.aforo.space:8092,http://usage.dev.aforo.space:8081,http://ingestion.dev.aforo.space:8088,http://kong.dev.aforo.space:8086,http://org.dev.aforo.space:8081,http://quickbooks.dev.aforo.space:8095,http://subscription.dev.aforo.space:8084,http://localhost:3000,http://localhost:*,http://127.0.0.1:*,http://aforo.space,https://aforo.space,http://54.221.164.5,https://54.221.164.5}
    allowed-methods: "GET,POST,PUT,PATCH,DELETE,OPTIONS"
    allowed-headers: "Authorization,Content-Type,X-Organization-Id"
    allow-credentials: true
  organization-service:
    base-url: ${ORGANIZATION_SERVICE_URL:http://org.dev.aforo.space:8081}
    timeout-seconds: 30
  metering-service:
    base-url: ${METERING_SERVICE_URL:http://metering.dev.aforo.space:8092}
    timeout-seconds: 30
  rate-plan-service:
    base-url: ${RATE_PLAN_SERVICE_URL:http://product.dev.aforo.space:8080}
    timeout-seconds: 30

# Resilience4j Retry Configuration
resilience4j:
  retry:
    instances:
      quickbooks:
        max-attempts: 3
        wait-duration: 2s
        exponential-backoff-multiplier: 2
        retry-exceptions:
          - org.springframework.web.client.ResourceAccessException
          - aforo.quickbooks.exception.QuickBooksRateLimitException
  
  ratelimiter:
    instances:
      quickbooks:
        limit-for-period: 500
        limit-refresh-period: 1m
        timeout-duration: 5s

logging:
  level:
    com.aforo.quickbooks: DEBUG

# SpringDoc OpenAPI Configuration
springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /swagger-ui.html
    enabled: true
